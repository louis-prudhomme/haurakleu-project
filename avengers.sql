DROP TRIGGER trg_adt_report;
DROP TRIGGER trg_adt_keyword;
DROP TRIGGER trg_report_deadline;
DROP TRIGGER trg_report_validation;
DROP TRIGGER trg_teacher_hired_date;
DROP TRIGGER trg_student_promotion;

DROP PROCEDURE prc_delete_intermediary_reports;
DROP PROCEDURE prc_report_download;
DROP PROCEDURE prc_report_consult;
DROP PROCEDURE prc_report_copy;
DROP PROCEDURE prc_report_print;

DROP FUNCTION fun_is_allowed;
DROP FUNCTION fun_reports_by_keyword;
DROP FUNCTION fun_most_wanted_reports;

DROP TABLE adt_keyword;
DROP TABLE adt_report;
DROP TABLE rel_has;
DROP TABLE tab_keyword;
DROP TABLE tab_report;
DROP TABLE rel_performs;
DROP TABLE tab_student;
DROP TABLE tab_major;
DROP TABLE rel_teaches;
DROP TABLE tab_teacher;
DROP TABLE tab_company_tutor;
DROP TABLE tab_study_level;
DROP TABLE tab_teaching_field;
DROP TABLE tab_confidentiality_level;
DROP TABLE tab_company;
DROP TABLE tab_instructions;
DROP TABLE tab_user;

CREATE TABLE tab_user
(id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY
,first_name VARCHAR2(64)
,last_name VARCHAR2(64)
,avatar_path VARCHAR2(256)
,phone_number CHAR(10)
,email VARCHAR2(256)
,password VARCHAR(128)
,is_my_user INT DEFAULT 0 CHECK (is_my_user IN (0, 1))
,CONSTRAINT check_email
    CHECK (email LIKE '%@%.%'
		AND email NOT LIKE '@%'
		AND email NOT LIKE '%@%@%')
,CONSTRAINT check_phone_number
    CHECK (REGEXP_LIKE(phone_number, '^((\+)33|0)[1-9](\d{2}){4}$'))
,CONSTRAINT check_password_strength
    CHECK(REGEXP_LIKE(password, '^.*[A-Z].*$')
		AND REGEXP_LIKE(password, '^.*[0-9].*$')
		AND REGEXP_LIKE(password, '^.*[^A-Z,0-9].*$')
		AND REGEXP_LIKE(password, '^.*[!@#$%^&*(),.?":{}|<>].*$')
		AND LENGTHB(password) >= 8)
);

CREATE TABLE tab_instructions
(id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY
,guidelines VARCHAR2(512)
,deadline DATE
);

CREATE TABLE tab_company
(id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY
,name VARCHAR2(64)
);

CREATE TABLE tab_confidentiality_level
(id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY
,label VARCHAR2(64)
);

CREATE TABLE tab_teaching_field
(id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY
,label VARCHAR2(64)
);

CREATE TABLE tab_study_level
(id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY
,label VARCHAR2(64)
);

CREATE TABLE tab_company_tutor
(id INT NOT NULL PRIMARY KEY
,job VARCHAR2(64)
,CONSTRAINT inherit_user_tutor FOREIGN KEY (id)
	REFERENCES tab_user (id)
);

CREATE TABLE tab_teacher
(id INT NOT NULL PRIMARY KEY
,hired DATE
,CONSTRAINT inherit_user_teacher FOREIGN KEY (id)
	REFERENCES tab_user (id)
);

CREATE TABLE rel_teaches
(id_teacher INT NOT NULL
,id_field INT NOT NULL
,CONSTRAINT fk_teaches_teacher FOREIGN KEY (id_teacher)
	REFERENCES tab_teacher (id)
,CONSTRAINT fk_teaches_field FOREIGN KEY (id_field)
	REFERENCES tab_teaching_field (id)
,CONSTRAINT pk_teaches PRIMARY KEY (id_teacher, id_field)
);

CREATE TABLE tab_major
(id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY
,label VARCHAR2(64)
,id_major_director INT NOT NULL
,CONSTRAINT fk_major_director FOREIGN KEY (id_major_director)
	REFERENCES tab_teacher (id)
);

CREATE TABLE tab_student
(id INT NOT NULL PRIMARY KEY
,promotion INT CHECK (promotion BETWEEN 1936 AND 2154)
,is_apprentice INT DEFAULT 0 CHECK (is_apprentice IN (0, 1))
,id_major INT NOT NULL
,id_study_level INT NOT NULL
,CONSTRAINT inherit_user_student FOREIGN KEY (id)
	REFERENCES tab_user (id)
,CONSTRAINT fk_student_major FOREIGN KEY (id_major)
	REFERENCES tab_major (id)
,CONSTRAINT fk_student_level FOREIGN KEY (id_study_level)
	REFERENCES tab_study_level (id)
);

CREATE TABLE rel_performs
(id_student INT NOT NULL
,id_instructions INT NOT NULL
,CONSTRAINT fk_performs_student FOREIGN KEY (id_student)
	REFERENCES tab_student (id)
,CONSTRAINT fk_performs_instructions FOREIGN KEY (id_instructions)
	REFERENCES tab_instructions (id)
,CONSTRAINT pk_performs PRIMARY KEY (id_student, id_instructions)
);

CREATE TABLE tab_report
(id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY
,title VARCHAR2(64)
,submitted DATE DEFAULT SYSDATE
,is_pedag_vetted INT DEFAULT 0 CHECK (is_pedag_vetted IN (0, 1))
,is_company_vetted INT DEFAULT 0 CHECK (is_company_vetted IN (0, 1))
,id_student INT NOT NULL
,id_company INT NOT NULL
,id_pedag_tutor INT NOT NULL
,id_company_tutor INT NOT NULL
,id_conf_level INT NOT NULL
,id_instructions INT NOT NULL
,CONSTRAINT fk_report_student FOREIGN KEY (id_student)
	REFERENCES tab_student (id)
,CONSTRAINT fk_report_company FOREIGN KEY (id_company)
	REFERENCES tab_company (id)
,CONSTRAINT fk_report_teacher FOREIGN KEY (id_pedag_tutor)
	REFERENCES tab_teacher (id)
,CONSTRAINT fk_report_comp_tutor FOREIGN KEY (id_company_tutor)
	REFERENCES tab_company_tutor (id)
,CONSTRAINT fk_report_conf_level FOREIGN KEY (id_conf_level)
	REFERENCES tab_confidentiality_level (id)
,CONSTRAINT fk_report_instructions FOREIGN KEY (id_instructions)
	REFERENCES tab_instructions (id)
);

CREATE TABLE tab_keyword
(id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY
,word VARCHAR2(32)
);

CREATE TABLE rel_has
(id_report INT NOT NULL
,id_keyword INT NOT NULL
,CONSTRAINT fk_has_report FOREIGN KEY (id_report)
	REFERENCES tab_report (id) ON DELETE CASCADE
,CONSTRAINT fk_has_keyword FOREIGN KEY (id_keyword)
	REFERENCES tab_keyword (id)
,CONSTRAINT pk_has PRIMARY KEY (id_report, id_keyword)
);

CREATE TABLE adt_report
(id_report INT NOT NULL
,consults INT DEFAULT 0
,copies INT DEFAULT 0
,prints INT DEFAULT 0
,downloads INT DEFAULT 0
,CONSTRAINT fk_audit_report FOREIGN KEY (id_report)
	REFERENCES tab_report (id) ON DELETE CASCADE
,CONSTRAINT pk_audit_report PRIMARY KEY (id_report)
);

CREATE TABLE adt_keyword
(id_keyword INT NOT NULL
,searches INT DEFAULT 0
,CONSTRAINT fk_audit_keyword FOREIGN KEY (id_keyword)
	REFERENCES tab_keyword (id) ON DELETE CASCADE
,CONSTRAINT pk_audit_keyword PRIMARY KEY (id_keyword)
);

CREATE OR REPLACE FUNCTION fun_is_allowed
(pn_id_user NUMBER, pn_id_report NUMBER, pn_conf_level NUMBER)
RETURN NUMBER
AS
    ln_return NUMBER;
BEGIN
    DECLARE
        ln_chk_prms NUMBER;
        ln_chk_conf NUMBER;
        ln_chk_myus NUMBER;
        ln_chk_state NUMBER;
        ln_chk_partof NUMBER;

        le_no_record_found EXCEPTION;
        le_confidentiality_prohibits EXCEPTION;
        le_report_not_validated EXCEPTION;
        le_not_my_user EXCEPTION;
    BEGIN
        SELECT count(id)
            INTO ln_chk_prms
            FROM tab_report
            WHERE id = pn_id_report;

        SELECT count(id) + ln_chk_prms
            INTO ln_chk_prms
            FROM tab_user
            WHERE id = pn_id_user;

        IF ln_chk_prms <> 2 THEN
            RAISE le_no_record_found;
        END IF;

        SELECT id_conf_level
            INTO ln_chk_conf
            FROM tab_report
            WHERE id = pn_id_report;

        IF ln_chk_conf > pn_conf_level THEN
            RAISE le_confidentiality_prohibits;
        END IF;

        SELECT is_my_user
            INTO ln_chk_myus
            FROM tab_user
            WHERE id = pn_id_user;

        SELECT is_company_vetted + is_pedag_vetted
            INTO ln_chk_state
            FROM tab_report
            WHERE id = pn_id_report;

        SELECT count(id)
            INTO ln_chk_partof
            FROM tab_report
            WHERE id = pn_id_report
                AND (id_student = pn_id_user
                OR id_pedag_tutor = pn_id_user
                OR id_company_tutor = pn_id_user);

        IF ln_chk_state < 2 AND ln_chk_partof < 1 THEN
            RAISE le_report_not_validated;
        ELSIF ln_chk_myus = 0 AND ln_chk_partof < 1 THEN
            RAISE le_not_my_user;
        ELSE
            ln_return := 1;
        END IF;

    EXCEPTION
        WHEN le_no_record_found THEN
            RAISE_APPLICATION_ERROR(-20010, 'No matching records were found for either the provided report id or student id, or both.');
            ln_return := -1;
        WHEN le_confidentiality_prohibits THEN
            RAISE_APPLICATION_ERROR(-20011, 'Confidentiality settings disable this action.');
            ln_return := -1;
        WHEN le_report_not_validated THEN
            RAISE_APPLICATION_ERROR(-20012, 'The report has not been validated, action aborted.');
            ln_return := -1;
        WHEN le_not_my_user THEN
            RAISE_APPLICATION_ERROR(-20013, 'User must be a user of My Efrei.');
            ln_return := -1;
    END;

RETURN ln_return;
END fun_is_allowed;
/

CREATE OR REPLACE FUNCTION fun_reports_by_keyword
(pv_keyword VARCHAR2)
RETURN SYS_REFCURSOR
AS
    PRAGMA AUTONOMOUS_TRANSACTION;

    lc_reports SYS_REFCURSOR;
    ln_id_word INT;
BEGIN
    SELECT id
        INTO ln_id_word
        FROM tab_keyword
        WHERE word = pv_keyword;

    OPEN lc_reports FOR
        SELECT r.id AS id, r.title AS title
            FROM rel_has h 
            LEFT JOIN tab_report r
                ON h.id_report = r.id
            WHERE h.id_keyword = ln_id_word
            ORDER BY r.title;

    UPDATE adt_keyword
        SET searches = searches + 1
        WHERE id_keyword = ln_id_word;
    COMMIT;

    RETURN lc_reports;

    EXCEPTION
        WHEN NO_DATA_FOUND THEN
            RAISE_APPLICATION_ERROR(-20004, 'Keyword not found.');
            RETURN NULL;
END fun_reports_by_keyword;
/

CREATE OR REPLACE FUNCTION fun_most_wanted_reports
(pn_take_first NUMBER)
RETURN SYS_REFCURSOR
AS
    lc_most_wanted_keywords SYS_REFCURSOR;
BEGIN
    OPEN lc_most_wanted_keywords
        FOR SELECT * FROM (
                SELECT k.id AS id, k.word AS title, a.searches
                    FROM tab_keyword k
                    LEFT JOIN adt_keyword a 
                        ON k.id = a.id_keyword
                    ORDER BY a.searches DESC)
            WHERE ROWNUM <= pn_take_first;

    RETURN lc_most_wanted_keywords;
END fun_most_wanted_reports;
/

CREATE OR REPLACE PROCEDURE prc_report_print
(pn_id_user INT, pn_id_report INT)
AS
    PRAGMA AUTONOMOUS_TRANSACTION;
    ln_result INT;
BEGIN
    ln_result := fun_is_allowed(pn_id_user, pn_id_report, 1);
    IF ln_result = 1 THEN
        UPDATE adt_report
            SET prints = prints + 1
            WHERE id_report = pn_id_report;
        COMMIT;
    END IF;
END;
/

CREATE OR REPLACE PROCEDURE prc_report_copy
(pn_id_user INT, pn_id_report INT)
AS
    PRAGMA AUTONOMOUS_TRANSACTION;
    ln_result INT;
BEGIN
    ln_result := fun_is_allowed(pn_id_user, pn_id_report, 1);
    IF ln_result = 1 THEN
        UPDATE adt_report
            SET copies = copies + 1
            WHERE id_report = pn_id_report;
        COMMIT;
    END IF;
END;
/

CREATE OR REPLACE PROCEDURE prc_report_download
(pn_id_user INT, pn_id_report INT)
AS
    PRAGMA AUTONOMOUS_TRANSACTION;
    ln_result INT;
BEGIN
    ln_result := fun_is_allowed(pn_id_user, pn_id_report, 1);
    IF ln_result = 1 THEN
        UPDATE adt_report
            SET downloads = downloads + 1
            WHERE id_report = pn_id_report;
        COMMIT;
    END IF;
END;
/

CREATE OR REPLACE PROCEDURE prc_report_consult
(pn_id_user INT, pn_id_report INT)
AS
    PRAGMA AUTONOMOUS_TRANSACTION;
    ln_result INT;
BEGIN
    ln_result := fun_is_allowed(pn_id_user, pn_id_report, 2);
    IF ln_result = 1 THEN
        UPDATE adt_report
            SET consults = consults + 1
            WHERE id_report = pn_id_report;
        COMMIT;
    END IF;
END;
/

CREATE OR REPLACE PROCEDURE prc_delete_intermediary_reports
(pn_id_report INT, pd_submitted DATE, pn_id_student INT, pn_id_instructions INT)
AS
    PRAGMA AUTONOMOUS_TRANSACTION;
BEGIN
    DELETE FROM tab_report
        WHERE id <> pn_id_report
        AND submitted <= pd_submitted
        AND id_student = pn_id_student
        AND id_instructions = pn_id_instructions;
    COMMIT;
END;
/

CREATE OR REPLACE TRIGGER trg_report_validation
AFTER update OR insert
ON tab_report
FOR EACH ROW
WHEN (new.is_company_vetted = 1 AND new.is_pedag_vetted = 1)
DECLARE
    ln_keyword_count INT;
    le_not_enough_keywords EXCEPTION;
BEGIN
    SELECT count(id_keyword)
        INTO ln_keyword_count
        FROM rel_has
        WHERE id_report = :new.id;

    IF ln_keyword_count < 1 THEN
        RAISE le_not_enough_keywords;
    END IF;

    prc_delete_intermediary_reports(:new.id, :new.submitted, :new.id_student, :new.id_instructions);

EXCEPTION
    WHEN le_not_enough_keywords THEN
        RAISE_APPLICATION_ERROR(-20005, 'Expected at least one tab_keyword for this report.');
END;
/

CREATE OR REPLACE TRIGGER trg_teacher_hired_date
BEFORE INSERT OR UPDATE ON tab_teacher
FOR EACH ROW
DECLARE
    le_hired_date_exception EXCEPTION;
BEGIN
    IF :new.hired > SYSDATE THEN
        RAISE le_hired_date_exception;
    END IF;

EXCEPTION
    WHEN le_hired_date_exception THEN
        RAISE_APPLICATION_ERROR(-20003, 'The hired date can not be in the future.');
END;
/

CREATE OR REPLACE TRIGGER trg_report_deadline
BEFORE INSERT OR UPDATE OF submitted ON tab_report
FOR EACH ROW
DECLARE
    le_deadline_overdue EXCEPTION;
    ld_deadline_report DATE;
BEGIN
    SELECT DEADLINE
        INTO ld_deadline_report
        FROM tab_instructions
        WHERE tab_instructions.id = :new.id_instructions;

    IF :new.submitted > ld_deadline_report THEN
        RAISE le_deadline_overdue;
    END IF;

EXCEPTION
    WHEN le_deadline_overdue THEN
        RAISE_APPLICATION_ERROR(-20002, 'The tab_report is late, the deadline is over.');
END;
/

CREATE OR REPLACE TRIGGER trg_adt_report
AFTER INSERT ON tab_report
FOR EACH ROW
BEGIN
    INSERT INTO adt_report (id_report)
        VALUES (:new.id);
END;
/

CREATE OR REPLACE TRIGGER trg_adt_keyword
AFTER INSERT ON tab_keyword
FOR EACH ROW
BEGIN
    INSERT INTO adt_keyword (id_keyword)
        VALUES (:new.id);
END;
/

CREATE OR REPLACE TRIGGER trg_student_promotion
AFTER UPDATE OR INSERT
ON tab_student
FOR EACH ROW
DECLARE
    ln_current_prom VARCHAR2(64);
    ln_current_year INT;
    ln_current_month INT;

    ln_chk_promotion INT;
    le_wrong_promotion EXCEPTION;
BEGIN
    SELECT EXTRACT(YEAR FROM SYSDATE) 
        INTO ln_current_year 
        FROM DUAL;

    SELECT EXTRACT(MONTH FROM SYSDATE) 
        INTO ln_current_month 
        FROM DUAL;

    IF (:new.promotion > 0 AND ln_current_month < 13) THEN
        ln_current_year := ln_current_year - 1;
    END IF;
    
    ln_chk_promotion := ln_current_year + (6 - :new.id_study_level) - :new.promotion;
    
    IF ln_chk_promotion <> 0 and :new.id_study_level <> 6 THEN
        RAISE le_wrong_promotion;
    END IF;

    EXCEPTION
        WHEN le_wrong_promotion THEN
            RAISE_APPLICATION_ERROR(-20006, 'Inconsistency between the promotion of the student and his group');
END;
/

ALTER SESSION SET NLS_DATE_FORMAT = 'DD-MM-YYYY';

INSERT INTO tab_instructions (guidelines, deadline) VALUES ('Write down a tab_report of your internship', '26-03-2021');
INSERT INTO tab_instructions (guidelines, deadline) VALUES ('Write down a tab_report of your apprenticeship', '02-12-2021');
INSERT INTO tab_instructions (guidelines, deadline) VALUES ('Write down a tab_report of your internship ; it must be fourteen pages long', '26-01-2021');

INSERT INTO tab_company (name) VALUES ('MyCrauSauft');
INSERT INTO tab_company (name) VALUES ('Haurakleu');
INSERT INTO tab_company (name) VALUES ('Hapel');
INSERT INTO tab_company (name) VALUES ('Gougueule');
INSERT INTO tab_company (name) VALUES ('Hamhasaune');
INSERT INTO tab_company (name) VALUES ('LHVM');
INSERT INTO tab_company (name) VALUES ('L''Aureal Madryd');
INSERT INTO tab_company (name) VALUES ('Safoni');
INSERT INTO tab_company (name) VALUES ('Leonard');
INSERT INTO tab_company (name) VALUES ('OXO');
INSERT INTO tab_company (name) VALUES ('BPN Marseillebas');
INSERT INTO tab_company (name) VALUES ('Bleu Telecom');
INSERT INTO tab_company (name) VALUES ('Vivendive');
INSERT INTO tab_company (name) VALUES ('Societe globale');
INSERT INTO tab_company (name) VALUES ('Micheline');
INSERT INTO tab_company (name) VALUES ('Pythagore');
INSERT INTO tab_company (name) VALUES ('Curcumain');
INSERT INTO tab_company (name) VALUES ('Credit naval');
INSERT INTO tab_company (name) VALUES ('Lepetit');
INSERT INTO tab_company (name) VALUES ('Ricard');

INSERT INTO tab_confidentiality_level (id, label) VALUES (1, 'Normal');
INSERT INTO tab_confidentiality_level (id, label) VALUES (2, 'Low level');
INSERT INTO tab_confidentiality_level (id, label) VALUES (3, 'High level');

INSERT INTO tab_teaching_field (label) VALUES ('Object-Oriented Programming');
INSERT INTO tab_teaching_field (label) VALUES ('Database Administration');
INSERT INTO tab_teaching_field (label) VALUES ('Java Enterprise Edition');
INSERT INTO tab_teaching_field (label) VALUES ('XML');
INSERT INTO tab_teaching_field (label) VALUES ('Frontend');
INSERT INTO tab_teaching_field (label) VALUES ('Machine Learning');
INSERT INTO tab_teaching_field (label) VALUES ('English');
INSERT INTO tab_teaching_field (label) VALUES ('Mobile developement');
INSERT INTO tab_teaching_field (label) VALUES ('Bioengineering');
INSERT INTO tab_teaching_field (label) VALUES ('Business plan');
INSERT INTO tab_teaching_field (label) VALUES ('Project management');
INSERT INTO tab_teaching_field (label) VALUES ('C#');
INSERT INTO tab_teaching_field (label) VALUES ('.NET Core');
INSERT INTO tab_teaching_field (label) VALUES ('DevOps');
INSERT INTO tab_teaching_field (label) VALUES ('Reali-time systems');
INSERT INTO tab_teaching_field (label) VALUES ('Advanced Object-Oriented Programming');
INSERT INTO tab_teaching_field (label) VALUES ('Advanced Database Administration');
INSERT INTO tab_teaching_field (label) VALUES ('Advanced Java Enterprise Edition');
INSERT INTO tab_teaching_field (label) VALUES ('Advanced XML');
INSERT INTO tab_teaching_field (label) VALUES ('Advanced Frontend');
INSERT INTO tab_teaching_field (label) VALUES ('Advanced Machine Learning');
INSERT INTO tab_teaching_field (label) VALUES ('Advanced English');
INSERT INTO tab_teaching_field (label) VALUES ('Advanced Mobile developement');
INSERT INTO tab_teaching_field (label) VALUES ('Advanced Bioengineering');
INSERT INTO tab_teaching_field (label) VALUES ('Advanced Business plan');
INSERT INTO tab_teaching_field (label) VALUES ('Advanced Project management');
INSERT INTO tab_teaching_field (label) VALUES ('Advanced C#');
INSERT INTO tab_teaching_field (label) VALUES ('Advanced .NET Core');
INSERT INTO tab_teaching_field (label) VALUES ('Advanced DevOps');
INSERT INTO tab_teaching_field (label) VALUES ('Advanced Reali-time systems');

INSERT INTO tab_study_level (id, label) VALUES (1, 'L1');
INSERT INTO tab_study_level (id, label) VALUES (2, 'L2');
INSERT INTO tab_study_level (id, label) VALUES (3, 'L3');
INSERT INTO tab_study_level (id, label) VALUES (4, 'M1');
INSERT INTO tab_study_level (id, label) VALUES (5, 'M2');
INSERT INTO tab_study_level (id, label) VALUES (6,'OUT');

INSERT INTO tab_user (first_name, last_name, avatar_path, phone_number, email, password, is_my_user) VALUES ('Slayer', 'Doom', '666:/chainsaw.jpg', '0666136660', 'doomslayer@rip.tear', 'AA!45aaass', 0);
INSERT INTO tab_user (first_name, last_name, avatar_path, phone_number, email, password, is_my_user) VALUES ('John', 'Carmack', '/home/carmack/pictures/armadillo.png', '0498684962', 'johnc@idsoftware.com', 'f1aA6aa@', 1);
INSERT INTO tab_user (first_name, last_name, avatar_path, phone_number, email, password, is_my_user) VALUES ('Christian', 'Nguyen', 'http://gil.cc/esazew', '0691784249', 'es@ze.sk', 'aTiew9us@k', 1);
INSERT INTO tab_user (first_name, last_name, avatar_path, phone_number, email, password, is_my_user) VALUES ('Earl', 'Webster', 'http://gi.dm/fucwuula', '0818702908', 'rugo@fotabe.tw', 'loNNod0uk##', 0);
INSERT INTO tab_user (first_name, last_name, avatar_path, phone_number, email, password, is_my_user) VALUES ('Lydia', 'Park', 'http://duzin.gl/ho', '0486447349', 'izsafis@peopcoh.io', 'hoaAAho9nu@', 0);
INSERT INTO tab_user (first_name, last_name, avatar_path, phone_number, email, password, is_my_user) VALUES ('Alma', 'Hunter', 'http://web.pe/gedub', '0547197958', 'ej@la.bw', 'rol2otD#ef', 0);
INSERT INTO tab_user (first_name, last_name, avatar_path, phone_number, email, password, is_my_user) VALUES ('Clara', 'Paul', 'http://ogodmu.mv/vegarol', '0809984108', 'ti@nuh.za', 'vawe#3Dhne', 0);
INSERT INTO tab_user (first_name, last_name, avatar_path, phone_number, email, password, is_my_user) VALUES ('Henrietta', 'Underwood', 'http://bewhuk.us/hede', '0767025947', 'aphom@tajhuczi.bm', 'ali4F^ijim', 0);
INSERT INTO tab_user (first_name, last_name, avatar_path, phone_number, email, password, is_my_user) VALUES ('Genevieve', 'Caldwell', 'http://zefokrad.us/era', '0554030398', 'lopro@devet.hn', 'tab3Fe@jne', 1);
INSERT INTO tab_user (first_name, last_name, avatar_path, phone_number, email, password, is_my_user) VALUES ('Victoria', 'Fernandez', 'http://nuk.hr/jefwu', '0428439760', 'da@ode.ao', 'rohu4@hFum', 1);
INSERT INTO tab_user (first_name, last_name, avatar_path, phone_number, email, password, is_my_user) VALUES ('Gerald', 'Holland', 'http://juwol.nu/dohujav', '0172835010', 'koligmev@tin.lc', 'aplR5#ukun', 0);
INSERT INTO tab_user (first_name, last_name, avatar_path, phone_number, email, password, is_my_user) VALUES ('Mike', 'Morgan', 'http://ototol.ph/fa', '0230902204', 'sum@mewkosot.ke', 'ejb@o4piRv', 1);
INSERT INTO tab_user (first_name, last_name, avatar_path, phone_number, email, password, is_my_user) VALUES ('Anthony', 'Wells', 'http://gidahe.cm/cosvus', '0167152627', 'rifechu@ho.as', 'ja@l3Fdigu', 0);
INSERT INTO tab_user (first_name, last_name, avatar_path, phone_number, email, password, is_my_user) VALUES ('Olivia', 'Douglas', 'http://kikuwzo.al/vi', '0974071000', 'fu@polosip.tr', 'vo66i@Stirn', 0);
INSERT INTO tab_user (first_name, last_name, avatar_path, phone_number, email, password, is_my_user) VALUES ('Theresa', 'Tucker', 'http://petbe.ye/he', '0438562511', 'uloabi@ip.tn', 'idip5iD@sa', 0);
INSERT INTO tab_user (first_name, last_name, avatar_path, phone_number, email, password, is_my_user) VALUES ('Johanna', 'Rodriguez', 'http://burhu.fi/zad', '0562144554', 'umuuwic@mah.de', 'zasF4a^laj', 1);
INSERT INTO tab_user (first_name, last_name, avatar_path, phone_number, email, password, is_my_user) VALUES ('Elmer', 'Taylor', 'http://cusgaje.lc/oljo', '0191617302', 'cevop@kohlegci.rs', 'ij5G5*uselu', 0);
INSERT INTO tab_user (first_name, last_name, avatar_path, phone_number, email, password, is_my_user) VALUES ('Clara', 'Meyer', 'http://el.qa/bagjohzuc', '0560565572', 'gapaw@ji.zw', 'g4uaDj@aib', 1);
INSERT INTO tab_user (first_name, last_name, avatar_path, phone_number, email, password, is_my_user) VALUES ('Leo', 'Maxwell', 'http://zonnokbam.cr/weowu', '0319647451', 'rema@cum.qa', 'av3Sej#ino', 0);
INSERT INTO tab_user (first_name, last_name, avatar_path, phone_number, email, password, is_my_user) VALUES ('Bill', 'Silva', 'http://vigoj.to/jezurfu', '0465975796', 'ona@ru.je', 'nicz6#Figo', 0);
INSERT INTO tab_user (first_name, last_name, avatar_path, phone_number, email, password, is_my_user) VALUES ('Jessie', 'Barton', 'http://bopa.tm/gaw', '0959393230', 'wajez@zi.ss', 'uhivu3@Ctz', 0);
INSERT INTO tab_user (first_name, last_name, avatar_path, phone_number, email, password, is_my_user) VALUES ('Emma', 'Walsh', 'http://niabe.zw/wassem', '0145116566', 'kihavuca@vosrur.tp', 'kirSr@6ebm', 0);
INSERT INTO tab_user (first_name, last_name, avatar_path, phone_number, email, password, is_my_user) VALUES ('Dennis', 'Pena', 'http://izaru.kw/jinis', '0806976245', 'kip@cufihuw.md', 'julu@h3Fba', 0);
INSERT INTO tab_user (first_name, last_name, avatar_path, phone_number, email, password, is_my_user) VALUES ('Lillian', 'Martin', 'http://seluop.am/biwi', '0271019140', 'niwge@hemuwil.io', 'si4V@likel', 1);
INSERT INTO tab_user (first_name, last_name, avatar_path, phone_number, email, password, is_my_user) VALUES ('Franklin', 'Fields', 'http://boti.pg/hakkago', '0265799381', 'lub@nek.ge', 'mofac5@Dok', 1);
INSERT INTO tab_user (first_name, last_name, avatar_path, phone_number, email, password, is_my_user) VALUES ('Willie', 'Stewart', 'http://bud.az/pebo', '0585979273', 'uswespic@piule.vc', 'li6n@Xiasn', 1);
INSERT INTO tab_user (first_name, last_name, avatar_path, phone_number, email, password, is_my_user) VALUES ('Flora', 'Norris', 'http://savi.gb/poimo', '0824489470', 'kenevezi@jidcez.et', 'he4@3Cdawre', 0);
	
INSERT INTO tab_company_tutor (id, job) VALUES (1, 'Developer');
INSERT INTO tab_company_tutor (id, job) VALUES (2, 'Project manager');
INSERT INTO tab_company_tutor (id, job) VALUES (3, 'HR');
INSERT INTO tab_company_tutor (id, job) VALUES (4, 'Ingeneer');
INSERT INTO tab_company_tutor (id, job) VALUES (5, 'Developer');
INSERT INTO tab_company_tutor (id, job) VALUES (6, 'Lead developer');

INSERT INTO tab_teacher (id, hired) VALUES (7, '23-04-2008');
INSERT INTO tab_teacher (id, hired) VALUES (8, '25-09-2008');
INSERT INTO tab_teacher (id, hired) VALUES (9, '19-08-2011');
INSERT INTO tab_teacher (id, hired) VALUES (10, '28-09-2013');
INSERT INTO tab_teacher (id, hired) VALUES (11, '10-05-2015');
INSERT INTO tab_teacher (id, hired) VALUES (12, '17-12-2016');
INSERT INTO tab_teacher (id, hired) VALUES (13, '22-10-2018');

INSERT INTO rel_teaches (id_teacher, id_field) VALUES (9, 16);
INSERT INTO rel_teaches (id_teacher, id_field) VALUES (11, 17);
INSERT INTO rel_teaches (id_teacher, id_field) VALUES (12, 15);
INSERT INTO rel_teaches (id_teacher, id_field) VALUES (12, 7);
INSERT INTO rel_teaches (id_teacher, id_field) VALUES (11, 18);
INSERT INTO rel_teaches (id_teacher, id_field) VALUES (12, 10);
INSERT INTO rel_teaches (id_teacher, id_field) VALUES (8, 7);
INSERT INTO rel_teaches (id_teacher, id_field) VALUES (9, 9);
INSERT INTO rel_teaches (id_teacher, id_field) VALUES (12, 11);
INSERT INTO rel_teaches (id_teacher, id_field) VALUES (10, 9);
INSERT INTO rel_teaches (id_teacher, id_field) VALUES (11, 14);
INSERT INTO rel_teaches (id_teacher, id_field) VALUES (8, 4);
INSERT INTO rel_teaches (id_teacher, id_field) VALUES (11, 3);
INSERT INTO rel_teaches (id_teacher, id_field) VALUES (11, 2);
INSERT INTO rel_teaches (id_teacher, id_field) VALUES (10, 4);
INSERT INTO rel_teaches (id_teacher, id_field) VALUES (9, 3);
INSERT INTO rel_teaches (id_teacher, id_field) VALUES (12, 12);
INSERT INTO rel_teaches (id_teacher, id_field) VALUES (7, 19);
INSERT INTO rel_teaches (id_teacher, id_field) VALUES (11, 4);
INSERT INTO rel_teaches (id_teacher, id_field) VALUES (8, 18);
INSERT INTO rel_teaches (id_teacher, id_field) VALUES (8, 3);
INSERT INTO rel_teaches (id_teacher, id_field) VALUES (8, 15);
INSERT INTO rel_teaches (id_teacher, id_field) VALUES (11, 9);
INSERT INTO rel_teaches (id_teacher, id_field) VALUES (12, 6);

INSERT INTO tab_major (label, id_major_director) VALUES ('Software engineering', 10);
INSERT INTO tab_major (label, id_major_director) VALUES ('Business intelligence', 8);
INSERT INTO tab_major (label, id_major_director) VALUES ('Solar panels', 7);
INSERT INTO tab_major (label, id_major_director) VALUES ('Drones', 12);
INSERT INTO tab_major (label, id_major_director) VALUES ('Droids', 12);
INSERT INTO tab_major (label, id_major_director) VALUES ('Robots', 12);
INSERT INTO tab_major (label, id_major_director) VALUES ('Databases', 10);
INSERT INTO tab_major (label, id_major_director) VALUES ('Artificial Intelligence', 8);
INSERT INTO tab_major (label, id_major_director) VALUES ('Bioengineering', 9);
INSERT INTO tab_major (label, id_major_director) VALUES ('New energies', 12);
INSERT INTO tab_major (label, id_major_director) VALUES ('Avionics and Space', 11);

INSERT INTO tab_student (id, promotion, is_apprentice, id_major, id_study_level) VALUES (14, 2021, 0, 3, 4);
INSERT INTO tab_student (id, promotion, is_apprentice, id_major, id_study_level) VALUES (15, 2023, 0, 8, 2);
INSERT INTO tab_student (id, promotion, is_apprentice, id_major, id_study_level) VALUES (16, 2023, 1, 7, 2);
INSERT INTO tab_student (id, promotion, is_apprentice, id_major, id_study_level) VALUES (17, 2024, 0, 7, 1);
INSERT INTO tab_student (id, promotion, is_apprentice, id_major, id_study_level) VALUES (18, 2023, 1, 2, 2);
INSERT INTO tab_student (id, promotion, is_apprentice, id_major, id_study_level) VALUES (19, 2023, 1, 3, 2);
INSERT INTO tab_student (id, promotion, is_apprentice, id_major, id_study_level) VALUES (20, 2023, 0, 8, 2);
INSERT INTO tab_student (id, promotion, is_apprentice, id_major, id_study_level) VALUES (21, 2024, 1, 6, 1);
INSERT INTO tab_student (id, promotion, is_apprentice, id_major, id_study_level) VALUES (22, 2021, 1, 6, 4);
INSERT INTO tab_student (id, promotion, is_apprentice, id_major, id_study_level) VALUES (23, 2022, 1, 8, 3);
INSERT INTO tab_student (id, promotion, is_apprentice, id_major, id_study_level) VALUES (24, 2023, 0, 7, 2);
INSERT INTO tab_student (id, promotion, is_apprentice, id_major, id_study_level) VALUES (25, 2022, 1, 8, 3);
INSERT INTO tab_student (id, promotion, is_apprentice, id_major, id_study_level) VALUES (26, 2024, 1, 5, 1);
INSERT INTO tab_student (id, promotion, is_apprentice, id_major, id_study_level) VALUES (27, 2024, 1, 4, 1);

INSERT INTO rel_performs (id_student, id_instructions) VALUES (22, 3);
INSERT INTO rel_performs (id_student, id_instructions) VALUES (24, 3);
INSERT INTO rel_performs (id_student, id_instructions) VALUES (26, 3);
INSERT INTO rel_performs (id_student, id_instructions) VALUES (26, 1);
INSERT INTO rel_performs (id_student, id_instructions) VALUES (18, 1);
INSERT INTO rel_performs (id_student, id_instructions) VALUES (26, 2);
INSERT INTO rel_performs (id_student, id_instructions) VALUES (19, 3);
INSERT INTO rel_performs (id_student, id_instructions) VALUES (21, 2);
INSERT INTO rel_performs (id_student, id_instructions) VALUES (23, 1);
INSERT INTO rel_performs (id_student, id_instructions) VALUES (15, 1);
INSERT INTO rel_performs (id_student, id_instructions) VALUES (18, 2);
INSERT INTO rel_performs (id_student, id_instructions) VALUES (24, 2);
INSERT INTO rel_performs (id_student, id_instructions) VALUES (25, 1);
INSERT INTO rel_performs (id_student, id_instructions) VALUES (21, 3);
INSERT INTO rel_performs (id_student, id_instructions) VALUES (27, 2);
INSERT INTO rel_performs (id_student, id_instructions) VALUES (27, 1);

INSERT INTO tab_report (title, is_pedag_vetted, is_company_vetted, id_student, id_company, id_pedag_tutor, id_company_tutor, id_conf_level, id_instructions) VALUES ('1554 Ulakeg View', 0, 0, 20, 9, 11, 3, 1, 3);
INSERT INTO tab_report (title, is_pedag_vetted, is_company_vetted, id_student, id_company, id_pedag_tutor, id_company_tutor, id_conf_level, id_instructions) VALUES ('1609 Gawi Key', 0, 1, 27, 2, 7, 3, 2, 1);
INSERT INTO tab_report (title, is_pedag_vetted, is_company_vetted, id_student, id_company, id_pedag_tutor, id_company_tutor, id_conf_level, id_instructions) VALUES ('1155 Lomji Ridge', 0, 1, 22, 17, 11, 3, 2, 1);
INSERT INTO tab_report (title, is_pedag_vetted, is_company_vetted, id_student, id_company, id_pedag_tutor, id_company_tutor, id_conf_level, id_instructions) VALUES ('1669 Reoho Place', 0, 0, 16, 14, 10, 2, 1, 2);
INSERT INTO tab_report (title, is_pedag_vetted, is_company_vetted, id_student, id_company, id_pedag_tutor, id_company_tutor, id_conf_level, id_instructions) VALUES ('1558 Momrom Glen', 0, 1, 19, 2, 9, 1, 2, 1);
INSERT INTO tab_report (title, is_pedag_vetted, is_company_vetted, id_student, id_company, id_pedag_tutor, id_company_tutor, id_conf_level, id_instructions) VALUES ('315 Fafa River', 0, 0, 15, 9, 8, 5, 2, 3);
INSERT INTO tab_report (title, is_pedag_vetted, is_company_vetted, id_student, id_company, id_pedag_tutor, id_company_tutor, id_conf_level, id_instructions) VALUES ('834 Defo Extension', 0, 1, 21, 10, 8, 1, 2, 2);
INSERT INTO tab_report (title, is_pedag_vetted, is_company_vetted, id_student, id_company, id_pedag_tutor, id_company_tutor, id_conf_level, id_instructions) VALUES ('1473 Hatoh Path', 1, 0, 19, 9, 7, 5, 3, 3);
INSERT INTO tab_report (title, is_pedag_vetted, is_company_vetted, id_student, id_company, id_pedag_tutor, id_company_tutor, id_conf_level, id_instructions) VALUES ('952 Hejtut View', 0, 1, 22, 9, 11, 3, 3, 2);
INSERT INTO tab_report (title, is_pedag_vetted, is_company_vetted, id_student, id_company, id_pedag_tutor, id_company_tutor, id_conf_level, id_instructions) VALUES ('1505 Niswu Glen', 0, 1, 22, 15, 10, 1, 2, 1);
INSERT INTO tab_report (title, is_pedag_vetted, is_company_vetted, id_student, id_company, id_pedag_tutor, id_company_tutor, id_conf_level, id_instructions) VALUES ('149 Jakuj Manor', 0, 1, 17, 11, 10, 3, 1, 1);
INSERT INTO tab_report (title, is_pedag_vetted, is_company_vetted, id_student, id_company, id_pedag_tutor, id_company_tutor, id_conf_level, id_instructions) VALUES ('1592 Gelsav Manor', 1, 0, 20, 12, 10, 2, 1, 3);
INSERT INTO tab_report (title, is_pedag_vetted, is_company_vetted, id_student, id_company, id_pedag_tutor, id_company_tutor, id_conf_level, id_instructions) VALUES ('419 Adpic Glen', 1, 0, 27, 6, 9, 1, 3, 2);
INSERT INTO tab_report (title, is_pedag_vetted, is_company_vetted, id_student, id_company, id_pedag_tutor, id_company_tutor, id_conf_level, id_instructions) VALUES ('1580 Otaaza Extension', 0, 1, 15, 7, 13, 3, 2, 1);
INSERT INTO tab_report (title, is_pedag_vetted, is_company_vetted, id_student, id_company, id_pedag_tutor, id_company_tutor, id_conf_level, id_instructions) VALUES ('1065 Lohat Drive', 0, 1, 24, 4, 12, 4, 1, 2);
INSERT INTO tab_report (title, is_pedag_vetted, is_company_vetted, id_student, id_company, id_pedag_tutor, id_company_tutor, id_conf_level, id_instructions) VALUES ('1853 Obza Parkway', 0, 1, 17, 13, 8, 2, 3, 2);
INSERT INTO tab_report (title, is_pedag_vetted, is_company_vetted, id_student, id_company, id_pedag_tutor, id_company_tutor, id_conf_level, id_instructions) VALUES ('220 Siit Glen', 0, 1, 17, 10, 12, 2, 3, 3);
INSERT INTO tab_report (title, is_pedag_vetted, is_company_vetted, id_student, id_company, id_pedag_tutor, id_company_tutor, id_conf_level, id_instructions) VALUES ('1409 Fosbe Park', 0, 0, 15, 2, 13, 3, 2, 1);
INSERT INTO tab_report (title, is_pedag_vetted, is_company_vetted, id_student, id_company, id_pedag_tutor, id_company_tutor, id_conf_level, id_instructions) VALUES ('196 Lejzu Place', 0, 1, 17, 10, 13, 2, 1, 1);
INSERT INTO tab_report (title, is_pedag_vetted, is_company_vetted, id_student, id_company, id_pedag_tutor, id_company_tutor, id_conf_level, id_instructions) VALUES ('1143 Tazsu Grove', 1, 0, 24, 4, 9, 2, 2, 2);
INSERT INTO tab_report (title, is_pedag_vetted, is_company_vetted, id_student, id_company, id_pedag_tutor, id_company_tutor, id_conf_level, id_instructions) VALUES ('1737 Jopic Lane', 0, 1, 16, 17, 11, 5, 1, 3);
INSERT INTO tab_report (title, is_pedag_vetted, is_company_vetted, id_student, id_company, id_pedag_tutor, id_company_tutor, id_conf_level, id_instructions) VALUES ('350 Gimufi View', 1, 0, 26, 14, 12, 1, 2, 3);
INSERT INTO tab_report (title, is_pedag_vetted, is_company_vetted, id_student, id_company, id_pedag_tutor, id_company_tutor, id_conf_level, id_instructions) VALUES ('1720 Mevu Lane', 0, 1, 27, 17, 12, 2, 1, 1);
INSERT INTO tab_report (title, is_pedag_vetted, is_company_vetted, id_student, id_company, id_pedag_tutor, id_company_tutor, id_conf_level, id_instructions) VALUES ('229 Peso Pike', 0, 1, 25, 4, 12, 5, 3, 2);
INSERT INTO tab_report (title, is_pedag_vetted, is_company_vetted, id_student, id_company, id_pedag_tutor, id_company_tutor, id_conf_level, id_instructions) VALUES ('1523 Fuef Square', 0, 1, 16, 9, 9, 4, 1, 3);
INSERT INTO tab_report (title, is_pedag_vetted, is_company_vetted, id_student, id_company, id_pedag_tutor, id_company_tutor, id_conf_level, id_instructions) VALUES ('1305 Piuga Grove', 0, 0, 23, 16, 7, 4, 3, 1);
INSERT INTO tab_report (title, is_pedag_vetted, is_company_vetted, id_student, id_company, id_pedag_tutor, id_company_tutor, id_conf_level, id_instructions) VALUES ('1427 Demdi Glen', 0, 0, 15, 14, 13, 5, 3, 3);
INSERT INTO tab_report (title, is_pedag_vetted, is_company_vetted, id_student, id_company, id_pedag_tutor, id_company_tutor, id_conf_level, id_instructions) VALUES ('570 Zife Manor', 0, 1, 20, 7, 10, 1, 2, 1);
INSERT INTO tab_report (title, is_pedag_vetted, is_company_vetted, id_student, id_company, id_pedag_tutor, id_company_tutor, id_conf_level, id_instructions) VALUES ('1613 Ovjig Pass', 1, 0, 18, 6, 12, 3, 2, 2);

INSERT INTO tab_keyword (word) VALUES ('JEE');
INSERT INTO tab_keyword (word) VALUES ('Bank');
INSERT INTO tab_keyword (word) VALUES ('Oracle');
INSERT INTO tab_keyword (word) VALUES ('SSII');
INSERT INTO tab_keyword (word) VALUES ('ESN');
INSERT INTO tab_keyword (word) VALUES ('Master');
INSERT INTO tab_keyword (word) VALUES ('Java');
INSERT INTO tab_keyword (word) VALUES ('C#');
INSERT INTO tab_keyword (word) VALUES ('AWS');
INSERT INTO tab_keyword (word) VALUES ('Cloud');
INSERT INTO tab_keyword (word) VALUES ('SI');
INSERT INTO tab_keyword (word) VALUES ('Systèmes d’information');
INSERT INTO tab_keyword (word) VALUES ('Big Data');

INSERT INTO rel_has (id_report, id_keyword) VALUES (21, 3);
INSERT INTO rel_has (id_report, id_keyword) VALUES (15, 11);
INSERT INTO rel_has (id_report, id_keyword) VALUES (28, 8);
INSERT INTO rel_has (id_report, id_keyword) VALUES (2, 2);
INSERT INTO rel_has (id_report, id_keyword) VALUES (13, 3);
INSERT INTO rel_has (id_report, id_keyword) VALUES (10, 8);
INSERT INTO rel_has (id_report, id_keyword) VALUES (5, 12);
INSERT INTO rel_has (id_report, id_keyword) VALUES (8, 2);
INSERT INTO rel_has (id_report, id_keyword) VALUES (23, 4);
INSERT INTO rel_has (id_report, id_keyword) VALUES (4, 12);
INSERT INTO rel_has (id_report, id_keyword) VALUES (2, 4);
INSERT INTO rel_has (id_report, id_keyword) VALUES (10, 13);
INSERT INTO rel_has (id_report, id_keyword) VALUES (1, 1);
INSERT INTO rel_has (id_report, id_keyword) VALUES (10, 10);
INSERT INTO rel_has (id_report, id_keyword) VALUES (4, 3);
INSERT INTO rel_has (id_report, id_keyword) VALUES (8, 3);
INSERT INTO rel_has (id_report, id_keyword) VALUES (12, 5);
INSERT INTO rel_has (id_report, id_keyword) VALUES (8, 4);
INSERT INTO rel_has (id_report, id_keyword) VALUES (19, 12);
INSERT INTO rel_has (id_report, id_keyword) VALUES (22, 6);
INSERT INTO rel_has (id_report, id_keyword) VALUES (7, 5);
INSERT INTO rel_has (id_report, id_keyword) VALUES (14, 11);
INSERT INTO rel_has (id_report, id_keyword) VALUES (11, 5);
INSERT INTO rel_has (id_report, id_keyword) VALUES (26, 9);
INSERT INTO rel_has (id_report, id_keyword) VALUES (13, 8);
INSERT INTO rel_has (id_report, id_keyword) VALUES (21, 7);
INSERT INTO rel_has (id_report, id_keyword) VALUES (11, 6);
INSERT INTO rel_has (id_report, id_keyword) VALUES (2, 9);
INSERT INTO rel_has (id_report, id_keyword) VALUES (13, 12);
INSERT INTO rel_has (id_report, id_keyword) VALUES (20, 4);
INSERT INTO rel_has (id_report, id_keyword) VALUES (24, 13);
INSERT INTO rel_has (id_report, id_keyword) VALUES (8, 10);
INSERT INTO rel_has (id_report, id_keyword) VALUES (10, 4);
INSERT INTO rel_has (id_report, id_keyword) VALUES (7, 2);
INSERT INTO rel_has (id_report, id_keyword) VALUES (5, 8);
INSERT INTO rel_has (id_report, id_keyword) VALUES (10, 11);
INSERT INTO rel_has (id_report, id_keyword) VALUES (3, 8);
INSERT INTO rel_has (id_report, id_keyword) VALUES (22, 9);
INSERT INTO rel_has (id_report, id_keyword) VALUES (25, 3);
INSERT INTO rel_has (id_report, id_keyword) VALUES (9, 8);
INSERT INTO rel_has (id_report, id_keyword) VALUES (20, 5);
INSERT INTO rel_has (id_report, id_keyword) VALUES (28, 7);
INSERT INTO rel_has (id_report, id_keyword) VALUES (11, 4);
INSERT INTO rel_has (id_report, id_keyword) VALUES (21, 4);
INSERT INTO rel_has (id_report, id_keyword) VALUES (12, 8);
INSERT INTO rel_has (id_report, id_keyword) VALUES (13, 10);
INSERT INTO rel_has (id_report, id_keyword) VALUES (27, 12);
INSERT INTO rel_has (id_report, id_keyword) VALUES (7, 6);
INSERT INTO rel_has (id_report, id_keyword) VALUES (9, 5);
INSERT INTO rel_has (id_report, id_keyword) VALUES (1, 2);
INSERT INTO rel_has (id_report, id_keyword) VALUES (5, 5);
INSERT INTO rel_has (id_report, id_keyword) VALUES (27, 9);
INSERT INTO rel_has (id_report, id_keyword) VALUES (15, 3);
INSERT INTO rel_has (id_report, id_keyword) VALUES (10, 2);
INSERT INTO rel_has (id_report, id_keyword) VALUES (14, 3);
INSERT INTO rel_has (id_report, id_keyword) VALUES (13, 2);
INSERT INTO rel_has (id_report, id_keyword) VALUES (2, 6);
INSERT INTO rel_has (id_report, id_keyword) VALUES (21, 10);
INSERT INTO rel_has (id_report, id_keyword) VALUES (23, 5);

COMMIT;

-- we select the number of views before
SELECT tab_keyword.word, adt_keyword.searches
    FROM adt_keyword
    LEFT JOIN tab_keyword
        ON tab_keyword.id = adt_keyword.id_keyword
    WHERE tab_keyword.word = 'JEE';

-- test get tab_report by tab_keyword
SET SERVEROUTPUT ON SIZE 1000000
DECLARE
    lc_results SYS_REFCURSOR;
    ln_id_keyword NUMBER;
    lv_title_keyword VARCHAR2(64);
BEGIN
    lc_results := fun_reports_by_keyword('JEE');

    LOOP
        FETCH lc_results
        INTO ln_id_keyword, lv_title_keyword;
        EXIT WHEN lc_results%NOTFOUND;
        DBMS_OUTPUT.PUT_LINE(ln_id_keyword || ' | ' || lv_title_keyword);
    END LOOP;
    CLOSE lc_results;
END;
/

-- we select the number of views after (a view rel_has been gained from the previous instruction)
SELECT tab_keyword.word, adt_keyword.searches
    FROM adt_keyword
    LEFT JOIN tab_keyword
        ON tab_keyword.id = adt_keyword.id_keyword
    WHERE tab_keyword.word = 'JEE';

-- selecting the ten most searched keywords
SELECT tab_keyword.word, adt_keyword.searches
    FROM adt_keyword
    LEFT JOIN tab_keyword
        ON tab_keyword.id = adt_keyword.id_keyword
    WHERE ROWNUM < 10
    ORDER BY adt_keyword.searches DESC;

-- trying to select a tab_keyword that doesnt exist, will raise an exception
SET SERVEROUTPUT ON SIZE 1000000
DECLARE
    lc_results SYS_REFCURSOR;
    ln_id_keyword NUMBER;
    lv_title_keyword VARCHAR2(64);
BEGIN
    lc_results := fun_reports_by_keyword('idontexist');

    LOOP
        FETCH lc_results
        INTO ln_id_keyword, lv_title_keyword;
        EXIT WHEN lc_results%NOTFOUND;
        DBMS_OUTPUT.PUT_LINE(ln_id_keyword || ' | ' || lv_title_keyword);
    END LOOP;
    CLOSE lc_results;
END;
/

-- test get most wanted reports
SET SERVEROUTPUT ON SIZE 1000000
DECLARE
    lc_results SYS_REFCURSOR;
    ln_id_keyword NUMBER;
    lv_title_keyword VARCHAR2(64);
    ln_researches_keyword NUMBER;
BEGIN
    lc_results := fun_most_wanted_reports(5);

    LOOP
        FETCH lc_results
        INTO ln_id_keyword, lv_title_keyword, ln_researches_keyword;
        EXIT WHEN lc_results%NOTFOUND;
        DBMS_OUTPUT.PUT_LINE('id tab_keyword : '|| ln_id_keyword || ' | ' || 'word : ' || lv_title_keyword || ' | ' || 'nb search : '|| ln_researches_keyword);
    END LOOP;
    CLOSE lc_results;
END;
/

-- select the most consulted reports before consulting one
SELECT tab_report.id, tab_report.title, adt_report.consults
    FROM tab_report
    LEFT JOIN adt_report
        ON tab_report.id = adt_report.id_report
    WHERE ROWNUM < 10
    ORDER BY adt_report.consults DESC;

-- consulting a tab_report
BEGIN
        prc_report_consult(20, 1);
END;
/

-- select the most consulted reports after is rel_has been updated
SELECT tab_report.id, tab_report.title, adt_report.consults
    FROM tab_report
    LEFT JOIN adt_report
        ON tab_report.id = adt_report.id_report
    WHERE ROWNUM < 10
    ORDER BY adt_report.consults DESC;

-- trying to consult the same tab_report wit another user will raise an exception because it rel_has not been validated and this user hasn’t partticpated in the tab_report
BEGIN
    prc_report_consult(1, 1);
END;
/

-- trying to insert a validated tab_report without keywords crashes
INSERT INTO tab_report (title, is_pedag_vetted, is_company_vetted, id_student, id_company, id_pedag_tutor, id_company_tutor, id_conf_level, id_instructions) VALUES ('1613 Ovjig Pass', 1, 1, 18, 6, 12, 3, 2, 2);

-- inserting it not validated
INSERT INTO tab_report (title, is_pedag_vetted, is_company_vetted, id_student, id_company, id_pedag_tutor, id_company_tutor, id_conf_level, id_instructions) VALUES ('1613 Ovjig Pass', 1, 0, 18, 6, 12, 3, 2, 2);

--adding tab_keyword
INSERT INTO rel_has VALUES((SELECT max(id) FROM tab_report), 1);

-- updating tab_report to validate it
UPDATE tab_report SET is_company_vetted = 1
    WHERE id = (SELECT max(id) FROM tab_report);

-- displaying the tab_report
SELECT * FROM tab_report
    WHERE id = (SELECT max(id) FROM tab_report);

COMMIT;

-- consulting this tab_report is autorized because its confidentiality is <= 2
DECLARE
    ln_last_report INT;
    ln_last_report_student INT;
BEGIN
    SELECT max(id)
        INTO ln_last_report
        FROM tab_report;

    SELECT id_student
        INTO ln_last_report_student
        FROM tab_report
        WHERE id = ln_last_report;

    prc_report_consult(ln_last_report_student, ln_last_report);
END;
/

-- printing this tab_report is forbidden because its confidentiality is >= 2
DECLARE
    ln_last_report INT;
    ln_last_report_student INT;
BEGIN
    SELECT max(id)
        INTO ln_last_report
        FROM tab_report;

    SELECT id_student
        INTO ln_last_report_student
        FROM tab_report
        WHERE id = ln_last_report;

    prc_report_print(ln_last_report_student, ln_last_report);
END;
/